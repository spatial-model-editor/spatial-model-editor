name: GUI/CLI Release Builds

on: push

jobs:
  win64-gui:
    name: Windows 32-bit GUI/CLI
    runs-on: windows-2019
    defaults:
      run:
        shell: msys2 {0}
    steps:
      - uses: actions/checkout@v2
        with:
          submodules: 'true'
      - uses: msys2/setup-msys2@v2
        with:
          msystem: MINGW32
          update: true
          install: mingw-w64-i686-gcc mingw-w64-i686-cmake mingw-w64-i686-ccache make
      - name: Set "latest" version number unless commit is version tagged
        if: startsWith(github.event.ref, 'refs/tags/1.') == false
        run: ./ci/set-latest-version.sh ${GITHUB_SHA}
      - name: Cache ccache
        uses: actions/cache@v2
        with:
          path: D:\a\_temp\msys64\home\runneradmin\ccache
          key: ccache-${{ github.job }}-${{ runner.os }}-${{ github.sha }}
          restore-keys: ccache-${{ github.job }}-${{ runner.os }}-
      - name: Get static libs
        run: ./ci/getlibs.sh win32-mingw
      - name: Build script
        run: ci/windows-gui.sh
